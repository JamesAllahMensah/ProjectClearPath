<!DOCTYPE html>
<html lang="en">
<meta charset="UTF-8">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://apis.google.com/js/platform.js" async defer></script>
<script src="scripts.js"></script>

<style>
    table, th, td {
        border: 1px solid black;
        border-collapse: collapse;
    }
    th, td {
        padding: 5px;
        text-align: center;
    }

    .tooltip {
        position: relative;
    }

    /* Tooltip text */
    .tooltip .tooltiptext {
        visibility: hidden;
        width: 250px;
        background-color: lightgrey;
        color: black;
        text-align: center;
        border-radius: 6px;

        position: absolute;
        z-index: 1;
        right: 10px;
        top: -70px;
    }

    .clear-course {
        background: transparent;
        border: none transparent;
        outline: none;
        cursor: pointer;
        color: red;
    }

    /* Show the tooltip text when you mouse over the tooltip container */
    .tooltip:hover .tooltiptext {
        visibility: visible;
    }

    .modal {
        display: none; /* Hidden by default */
        position: fixed; /* Stay in place */
        z-index: 50; /* Sit on top */
        left: 0;
        top: 0;
        width: 100%; /* Full width */
        height: 100%; /* Full height */
        overflow: auto; /* Enable scroll if needed */
        background-color: rgb(0,0,0); /* Fallback color */
        background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
    }

    /* Modal Content/Box */
    .modal-content {
        background-color: #fefefe;
        margin: 15% auto; /* 15% from the top and centered */
        padding: 20px;
        border: 1px solid #888;
        width: 30%; /* Could be more or less, depending on screen size */
    }

    .close {
        color: #aaa;
        float: right;
        font-size: 28px;
        font-weight: bold;
    }

    .close:hover,
    .close:focus {
        color: black;
        text-decoration: none;
        cursor: pointer;
    }

    .courseOptions {
        cursor: pointer;
    }

    .courseOptions:active {
        cursor: grab;
    }

    button {
        background: transparent;
        border: none;
        color: white
    }

    button:hover {
        cursor: pointer
    }



</style>
<head>
    <meta charset="UTF-8">
    <title>Plan</title>
</head>
<body style = "background: #1e376d;">
<button onclick = "navMain()">Return to Main Menu</button>
<button onclick = "savePlan()">Save Plan</button>
<button onclick = "exportPlan()">Export Plan</button>
<div id = "planner-prompt" style = "position: absolute; width: 550px; height: 400px; background: #F0F0F0; top: 7%; left: 5%; border: 5px solid black">
    <!--    <h3 style ="text-align: center">FEEDBACK</h3><hr style ="width: 80%">-->
    <div id="program-requirements">
        <h3 style="margin-left: 15px"><b><i>Program Requirements</i></b></h3>
        <div class="tooltip">
            <p style="font-size: 10px; position: absolute; right: 10px; top: -55px">View Hidden Courses</p>
            <span id="guide-ref" style="font-size: 10px" class="tooltiptext">
            </span>
        </div>

        <table id="feedback-table" style="margin-left: 10px; border: none">
        </table>
    </div>
    <div id="core-curriculum">
        <h3 style="position: relative; margin-left: 15px"><b><i>Core Curriculum</i></b></h3>
        <table style="margin-left: 10px; border: none">
            <tr style="border: none">
                <td class="core-curr" style="border: none; font-size: 17px"><input id="AIDE" type="checkbox" value="AIDE" onclick="return false;" readonly="readonly"><b>AIDE</b></td>&nbsp;
                <td class="core-curr" style="border: none; font-size: 17px"><input id="AICE" type="checkbox" value="AICE" onclick="return false;" readonly="readonly"><b>AICE</b></td>&nbsp;
                <td class="core-curr" style="border: none; font-size: 17px"><input id="AIGM" type="checkbox" value="AIGM" onclick="return false;" readonly="readonly"><b>AIGM</b></td>&nbsp;
                <td class="core-curr" style="border: none; font-size: 17px"><input id="AINW" type="checkbox" value="AINW" onclick="return false;" readonly="readonly"><b>AINW</b></td>&nbsp;
                <td class="core-curr" style="border: none; font-size: 17px"><input id="AIWT" type="checkbox" value="AIWT" onclick="return false;" readonly="readonly"><b>AIWT</b></td>&nbsp;
                <td class="core-curr" style="border: none; font-size: 17px"><input id="WI" type="checkbox" value="WI" onclick="return false;" readonly="readonly"><b>WI</b></td>&nbsp;
            </tr>
            <tr style="border: none">
                <td class="core-curr" style="border: none; font-size: 17px"><input id="ECON" type="checkbox" value="ECON" onclick="return false;" readonly="readonly"><b>ECON</b></td>&nbsp;
                <td class="core-curr" style="border: none; font-size: 17px"><input id="LR" type="checkbox" value="LR" onclick="return false;" readonly="readonly"><b>LR</b></td>&nbsp;
                <td class="core-curr" style="border: none; font-size: 17px"><input id="MATH" type="checkbox" value="MATH" onclick="return false;" readonly="readonly"><b>MATH</b></td>&nbsp;
                <td class="core-curr" style="border: none; font-size: 17px"><input id="SLL" type="checkbox" value="SLL" onclick="return false;" readonly="readonly"><b>SLL</b></td>&nbsp;
                <td class="core-curr" style="border: none; font-size: 17px"><input id="WCL" type="checkbox" value="WCL" onclick="return false;" readonly="readonly"><b>WCL</b></td>&nbsp;
                <td class="core-curr" style="border: none; font-size: 17px"><input id="ADDSCI" type="checkbox" value="ADDSCI" onclick="return false;" readonly="readonly"><b>ADDSCI</b></td>&nbsp;
            </tr>
        </table>
    </div>

</div>

<!-- The Modal -->
<div id="myModal" class="modal">

    <!-- Modal content -->
    <div class="modal-content">
        <span class="close">&times;</span>
        <div id="course-information" style="text-align: center">
        </div>
    </div>

</div>

<div id = "course-loader" style = "position: absolute; width: 700px; height: 350px; background: #F0F0F0; bottom: 3%; left: 1%;border: 3px solid black">
    <select id="currentOption" onchange="changeOptions();" name="courses" id="courses" style = "text-align-last: center; margin-top: 10px; position: absolute; left: 300px; width: 12%;background: #F0F0F0" >
        <option id="majorSelect" value="CPSC">CPSC</option>
        <option id="CPSC-Select" value="CPSC">CPSC</option>
        <option id="CPEN-Select" value="CPEN">CPEN</option>
        <option id="CYBR-Select" value="CYBR">CYBR</option>
        <option id="EENG-Select" value="EENG">EENG</option>
        <option id="ENGR-Select" value="ENGR">ENGR</option>
        <option id="BSIS-Select" value="BSIS">BSIS</option>
        <option value="AIDE">AIDE</option>
        <option value="AICE">AICE</option>
        <option value="ADDSCI">ADDSCI</option>
        <option value="AIGM">AIGM</option>
        <option value="AINW">AINW</option>
        <option value="AIWT">AIWT</option>
        <option value="WI">WI</option>
        <option value="ECON">ECON</option>
        <option value="LR">LR</option>
        <option value="MATH">MATH</option>
        <option value="PHYS">PHYS</option>
        <option value="SLL">SLL</option>
        <option value="WCL">WCL</option>
    </select>
    <br><br><br>
    <div id="holdOptions">
    </div>
</div>
<div class = "container" id = "table-holder" style = "position: absolute; left: 50%;">
    <table style = "z-index: -10; width: 90%; background: #F0F0F0; height: 50px; table-layout: fixed; border: 3px solid black">
        <tr>
            <th colspan="4">First Year</th>
        </tr>
        <tr>
            <th style="background: grey" colspan="2">Fall Semester</th>
            <th style="background: grey" colspan="2">Spring Semester</th>
        </tr>
        <tr>

            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan00"> CPSC 150</td>
            <td id = "credit00">3</td>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan10"> CPSC 150</td>
            <td id = "credit10">3</td>

        </tr>
        <tr>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan01">CPSC 125</td>
            <td id = "credit01">3</td>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan11">CPSC 150</td>
            <td id="credit11">3</td>
        </tr>
        <tr>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan02">CPSC 125</td>
            <td id="credit02">3</td>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan12">CPSC 150</td>
            <td id="credit12">3</td>

        </tr>
        <tr>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan03">CPSC 125</td>
            <td id="credit03">3</td>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan13">CPSC 150</td>
            <td id="credit13">3</td>
        </tr>
        <tr>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan04">CPSC 125</td>
            <td id="credit04">3</td>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan14">CPSC 150</td>
            <td id="credit14">3</td>

        </tr>
        <tr>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan05">CPSC 125</td>
            <td id="credit05">3</td>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan15">CPSC 150</td>
            <td id="credit15">3</td>
        </tr>

        <tr>
            <th colspan="4">Second Year</th>
        </tr>
        <tr>
            <th style="background: grey" colspan="2">Fall Semester</th>
            <th style="background: grey" colspan="2">Spring Semester</th>
        </tr>
        <tr>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan20">CPSC 125</td>
            <td id="credit20">3</td>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan30">CPSC 150</td>
            <td id="credit30">3</td>

        </tr>
        <tr>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan21">CPSC 125</td>
            <td id="credit21">3</td>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan31">CPSC 150</td>
            <td id="credit31">3</td>
        </tr>
        <tr>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan22">CPSC 125</td>
            <td id="credit22">3</td>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan32">CPSC 150</td>
            <td id="credit32">3</td>

        </tr>
        <tr>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan23">CPSC 125</td>
            <td id="credit23">3</td>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan33">CPSC 150</td>
            <td id="credit33">3</td>
        </tr>
        <tr>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)"id="plan24">CPSC 125</td>
            <td id="credit24">3</td>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)"id="plan34">CPSC 150</td>
            <td id="credit34">3</td>

        </tr>
        <tr>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan25">CPSC 125</td>
            <td id="credit25">3</td>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan35">CPSC 150</td>
            <td id="credit35">3</td>
        </tr>

        <tr>
            <th colspan="4">Third Year</th>
        </tr>
        <tr>
            <th style="background: grey" colspan="2">Fall Semester</th>
            <th style="background: grey" colspan="2">Spring Semester</th>
        </tr>
        <tr>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan40">CPSC 125</td>
            <td id="credit40">3</td>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan50">CPSC 150</td>
            <td id="credit50">3</td>
        </tr>
        <tr>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan41">CPSC 125</td>
            <td id="credit41">3</td>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan51">CPSC 150</td>
            <td id="credit51">3</td>
        </tr>
        <tr>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan42">CPSC 125</td>
            <td id="credit42">3</td>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan52">CPSC 150</td>
            <td id="credit52">3</td>

        </tr>
        <tr>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan43">CPSC 125</td>
            <td id="credit43">3</td>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan53">CPSC 150</td>
            <td id="credit53">3</td>
        </tr>
        <tr>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan44" >CPSC 125</td>
            <td id="credit44">3</td>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan54">CPSC 150</td>
            <td id="credit54">3</td>

        </tr>
        <tr>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan45">CPSC 125</td>
            <td id="credit45">3</td>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan55">CPSC 150</td>
            <td id="credit55">3</td>
        </tr>

        <tr>
            <th colspan="4">Fourth Year</th>
        </tr>
        <tr>
            <th style="background: grey" colspan="2">Fall Semester</th>
            <th style="background: grey" colspan="2">Spring Semester</th>
        </tr>
        <tr>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan60">CPSC 125</td>
            <td id="credit60">3</td>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan70">CPSC 150</td>
            <td id="credit70">3</td>
        </tr>
        <tr>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan61">CPSC 125</td>
            <td id="credit61">3</td>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan71">CPSC 150</td>
            <td id="credit71">3</td>
        </tr>
        <tr>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan62">CPSC 125</td>
            <td id="credit62">3</td>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan72">CPSC 150</td>
            <td id="credit72">3</td>

        </tr>
        <tr>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan63">CPSC 125</td>
            <td id="credit63">3</td>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan73">CPSC 150</td>
            <td id="credit73">3</td>
        </tr>
        <tr>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan64" >CPSC 125</td>
            <td id="credit64">3</td>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan74">CPSC 150</td>
            <td id="credit74">3</td>

        </tr>
        <tr>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan65">CPSC 125</td>
            <td id="credit65">3</td>
            <td onmouseenter="showCloseButton(this)" onmouseleave="hideCloseButton(this)" id="plan75">CPSC 150</td>
            <td id="credit75">3</td>
        </tr>

    </table>
</div>

</body>
<script>
    // ________________________________________________________________
    // Modal Information
    var modal = document.getElementById("myModal");
    var span = document.getElementsByClassName("close")[0];

    span.onclick = function() {
        modal.style.display = "none";
    }

    window.onclick = function(event) {
        if (event.target == modal) {
            modal.style.display = "none";
        }
    }

    function showCourseInformation(specCourse){
        specCourse = specCourse.innerHTML
        let courseFamily = document.getElementById("currentOption").value
        let majorArr = chooseMajorOptions(courseFamily)
        let firstIndex = majorArr[0]
        if (typeof firstIndex === "string"){
            for (let i = 0; i < majorArr.length; i++){
                let majorLine = majorArr[i]
                let courseInfo = majorLine.split("\t")
                if (courseInfo.length == 8){
                    courseInfo.pop()
                }
                let courseName = courseInfo[0]
                if (courseName.includes(" ")){
                    let courseTitle = courseName.split(" ")
                    let actualCourseName = courseTitle[0]
                    courseInfo[0] = actualCourseName
                    courseTitle.shift()
                    let fullTitle = ""
                    for (let j = 0; j < courseTitle.length; j++){
                        fullTitle += " " + courseTitle[j]
                    }
                    fullTitle = fullTitle.trim()
                    courseInfo.splice(1, 0, fullTitle)
                }

                let course = courseInfo[0]
                if (course.trim() === specCourse.trim()){
                    let title = courseInfo[1]
                    let credits = courseInfo[2]
                    let description = courseInfo[3]
                    let prereq = courseInfo[4]
                    let coreq = courseInfo[5]

                    let modalDiv = document.getElementsByClassName("modal-content")[0]
                    modalDiv.children[1].innerHTML = ""

                    let infoDiv = document.getElementById("course-information")

                    let headerInfo = document.createElement("h3")
                    headerInfo.innerHTML = course + " - " + credits + " Credits"
                    infoDiv.appendChild(headerInfo)

                    let subHeaderInfo = document.createElement("h4")
                    subHeaderInfo.innerHTML = title


                    infoDiv.appendChild(subHeaderInfo)

                    let descriptionInfo = document.createElement("p")
                    descriptionInfo.innerHTML = description
                    infoDiv.appendChild(descriptionInfo)

                    if (prereq === "\"\"" || prereq == null || prereq.length == 0){
                        prereq = "None"
                    }

                    if (prereq != "None" && (prereq.includes(",") || prereq.includes(";"))){
                        while (prereq.includes(",") || prereq.includes(";")){
                            prereq = formatRequirements(prereq)
                        }
                    }

                    if (coreq === "\"\"" || coreq == null || coreq.length == 0){
                        coreq = "None"
                    }

                    if (coreq != "None" && (coreq.includes(",") || coreq.includes(";"))){
                        while (coreq.includes(",") || coreq.includes(";")){
                            coreq = formatRequirements(coreq)
                        }
                    }

                    let prereqInfo = document.createElement("p")
                    prereqInfo.innerHTML = ("Prerequisites: ").bold().italics() + prereq
                    infoDiv.appendChild(prereqInfo)

                    let coreqInfo = document.createElement("p")
                    coreqInfo.innerHTML = ("Corequisites: ").bold().italics() + coreq
                    infoDiv.appendChild(coreqInfo)
                    break

                }

            }
        }
        else {
            for (let i = 0; i < majorArr.length; i++){
                let specArray = majorArr[i]
                let courseName = specArray[0]
                if (courseName.trim() === specCourse.trim()){
                    let courseTitle = specArray[1]
                    let credits = specArray[2]

                    let modalDiv = document.getElementsByClassName("modal-content")[0]
                    modalDiv.children[1].innerHTML = ""

                    let infoDiv = document.getElementById("course-information")

                    let headerInfo = document.createElement("h3")
                    headerInfo.innerHTML = courseName + " - " + credits + " Credits"
                    infoDiv.appendChild(headerInfo)

                    let subHeaderInfo = document.createElement("h4")
                    subHeaderInfo.innerHTML = courseTitle
                    infoDiv.appendChild(subHeaderInfo)
                    break
                }
            }

            for (let i = 0; i < majorArr.length; i++){
                let specArray = majorArr[i]
                let courseName = specArray[0]
                if (courseName.includes(specCourse)){
                    let courseTitle = specArray[1]
                    let credits = specArray[2]

                    let modalDiv = document.getElementsByClassName("modal-content")[0]
                    modalDiv.children[1].innerHTML = ""

                    let infoDiv = document.getElementById("course-information")

                    let headerInfo = document.createElement("h3")
                    headerInfo.innerHTML = specCourse + " - " + credits + " Credits"
                    infoDiv.appendChild(headerInfo)

                    let subHeaderInfo = document.createElement("h4")
                    if (courseTitle.length == 2){
                        courseTitle = "Please Check Course Catalog For Info"
                        subHeaderInfo.innerHTML = courseTitle
                        infoDiv.appendChild(subHeaderInfo)

                        let catalogButton = document.createElement("button")
                        catalogButton.addEventListener("click", navCourseCatalog)
                        catalogButton.innerHTML = "View Course Catalog"
                        catalogButton.style.backgroundColor = "#1e376d"
                        infoDiv.appendChild(catalogButton)
                        break
                    }
                    subHeaderInfo.innerHTML = courseTitle
                    infoDiv.appendChild(subHeaderInfo)
                    break
                }
            }


        }

        modal.style.display = "block";
    }

    function formatRequirements(req){
        req = req.replace(","," or ")
        req = req.replace(";", " and ").trim()
        req = req.trim()
        return req
    }

    function navCourseCatalog(){
        window.open("https://cnu.edu/public/undergradcatalog/_pdf/cnu-undergraduate_catalog_20-21.pdf")
    }

    // ____________________________________________________________________________

    var CPEN = []
    var CPSC = []
    var CYBR = []
    var EENG = []
    var ENGR = []
    var PHYS = []
    var BSIS = []
    var ADDSCI = pullLiberalLearning("ADDSCI")
    var AICE = pullLiberalLearning("AICE")
    var AIDE = pullLiberalLearning("AIDE")
    var AIGM = pullLiberalLearning("AIGM")
    var AINW = pullLiberalLearning("AINW")
    var AIWT = pullLiberalLearning("AIWT")
    var ECON = pullLiberalLearning("ECON")
    var LR = pullLiberalLearning("LR")
    var MATH = pullLiberalLearning("MATH")
    var PHYS = pullLiberalLearning("PHYS")
    var SLL = pullLiberalLearning("SLL")
    var WCL = pullLiberalLearning("WCL")
    var WI = pullLiberalLearning("WI")
    var loadedClasses = []
    var aiceReq = [3, AICE]
    var addsciReq = [7, ADDSCI]
    var aideReq = [3, AIDE]
    var aigmReq = [3, AIGM]
    var ainwReq = [7, AINW]
    var aiwtReq = [3, AIWT]
    var wclReq = [6, WCL]
    var sllReq = [3, SLL]
    var mathReq = [6,MATH]
    var lrReq = [3,LR]
    var econReq = [3,ECON]
    var WIreq = [5, WI]
    var electives = []
    var proElectives = []
    var SAVED = false

    var guide = {

    }

    const borderColor = {
        "color": "green"
    }

    var form_changed = false
    var CURRENT_ELEMENT = null


    // Drag Functions ____________________________________________________________________________________________________

    function dragElement(elmnt) {
        var origDimen = getOriginalDimensions()
        var pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
        if (document.getElementById(elmnt.id + "header")) {
            /* if present, the header is where you move the DIV from:*/
            document.getElementById(elmnt.id + "header").onmousedown = dragMouseDown;
        } else {
            /* otherwise, move the DIV from anywhere inside the DIV:*/
            elmnt.onmousedown = dragMouseDown;
        }


        function dragMouseDown(e) {
            e = e || window.event;
            e.preventDefault();
            pos3 = e.clientX;
            pos4 = e.clientY;
            document.onmouseup = closeDragElement;
            document.onmousemove = elementDrag;
        }


        function elementDrag(e) {
            e = e || window.event;
            e.preventDefault();
            pos1 = pos3 - e.clientX;
            pos2 = pos4 - e.clientY;
            pos3 = e.clientX;
            pos4 = e.clientY;

            let subtract_value = Math.floor((68/77) * (window.screen.height) - 393)
            elmnt.style.top = (pos4 - subtract_value) + "px";
            elmnt.style.left = (elmnt.offsetLeft - pos1) + "px";

            CURRENT_ELEMENT = elmnt


        }

        function closeDragElement(e) {
            document.onmouseup = null;
            document.onmousemove = null;

            let targetCourseID = e.target.id

            //________________________________________________________________
            //PRE/COREQ VALIDATION FEATURE

            let curr_elm = elmnt.innerHTML
            let curr_elm_txt = elmnt.innerText

            //________________________________________________________________
            let target_elm = document.getElementById(e.target.id)
            if (!validDrop(target_elm, elmnt)){
                for (let i = 0; i < origDimen.length; i++){
                    let find_course = origDimen[i][0]
                    if (elmnt.innerHTML == find_course){
                        let orig_left = origDimen[i][1]
                        let orig_top = origDimen[i][2]
                        elmnt.style.left = orig_left
                        elmnt.style.top = orig_top
                    }
                }
                CURRENT_ELEMENT = null
                return
            }
            else{
                let pRCheck = preReqCheck(curr_elm, targetCourseID)
                let cRCheck = coReqCheck(curr_elm, targetCourseID)

                let message, css, style
                let targetCourseElm = document.getElementById(targetCourseID)

                let dropConfirmation
                if (!pRCheck || !cRCheck){
                    if (!pRCheck && !cRCheck){
                        message = "Prerequisites & Corequisite requirements have not been met for " + curr_elm_txt

                    }
                    else if (!pRCheck){
                        message = "Prerequisites requirements have not been met for " + curr_elm_txt
                    }
                    else {
                        message = "Corequisites requirements have not been met for " + curr_elm_txt
                    }
                    message += "\nSelect OK to Override or Cancel to Remove the Course"

                    dropConfirmation = confirm(message)
                    if (!dropConfirmation){
                        for (let i = 0; i < origDimen.length; i++){
                            let find_course = origDimen[i][0]
                            if (elmnt.innerHTML == find_course){
                                let orig_left = origDimen[i][1]
                                let orig_top = origDimen[i][2]
                                elmnt.style.left = orig_left
                                elmnt.style.top = orig_top
                            }
                        }
                        CURRENT_ELEMENT = null
                        return
                    }
                }

                CURRENT_ELEMENT = null
            }


            document.getElementById(targetCourseID).innerHTML = elmnt.innerHTML

            let indexes = targetCourseID.substring(targetCourseID.length - 2)

            let closeButton = document.createElement("button")
            closeButton.setAttribute("class", "clear-course")
            closeButton.setAttribute("id", "clear-button" + indexes)
            closeButton.innerHTML= "X"
            closeButton.style.visibility = "hidden"
            document.getElementById(targetCourseID).appendChild(closeButton)
            document.getElementById("clear-button" + indexes).addEventListener("click", function(){
                clearCourseInfo(this);
            }, false)

            let course_select = document.getElementById("currentOption").value
            let course_options = chooseMajorOptions(course_select)
            let new_credits = getCourseDetails(course_select, "credits", elmnt.innerHTML)
            document.getElementById("credit" + indexes).innerHTML = new_credits

            elmnt.style.display = "none"
            getFeedBack()
            changeOptions()
            form_changed = true

        }


    }

    function validDrop(target, elm){
        if (target == null){
            return false
        }
        let table_div =  document.getElementById("table-holder")
        let table_pos_left = table_div.offsetLeft
        let table_width = table_div.offsetWidth

        let elm_left = parseInt(elm.style.left.substring(0, elm.style.left.length - 2))
        console.log(elm_left)
        if (elm_left >= table_pos_left && elm_left < (table_pos_left + table_width)){
            let activeCourses = document.getElementsByClassName("planner-table")
            let currCourses = []
            for (let i = 0; i < activeCourses.length; i++){
                let course = activeCourses[i].innerHTML
                course = course.split(" ")[0].split("<")[0]
                currCourses.push(course)
            }
            target = target.innerText.substring(0, target.innerText.length - 1)
            if (!currCourses.includes(target.trim())){
                for (let i = 0; i < currCourses.length; i++){
                    let current_course = currCourses[i]
                    if (current_course.includes(target.trim())){
                        return true
                    }
                }
                return false
            }
            return true
        }
        else {
            return false
        }


    }

    // ___________________________________________________________________________________________________________________

    /**
     * Returns [prereq, coreq] or null
     * The first for major courses, the second for non major courses
     * */

    function getReqInfo(currentCourseName){
        let courseFamily = document.getElementById("currentOption").value
        let majorArr = chooseMajorOptions(courseFamily)
        let firstIndex = majorArr[0]
        if (typeof firstIndex != "string"){
            return null
        }

        for (let i = 0; i < majorArr.length; i++){
            let majorLine = majorArr[i]
            let courseInfo = majorLine.split("\t")
            if (courseInfo.length == 8){
                courseInfo.pop()
            }
            let courseName = courseInfo[0]
            if (courseName.includes(" ")){
                let courseTitle = courseName.split(" ")
                let actualCourseName = courseTitle[0]
                courseInfo[0] = actualCourseName
                courseTitle.shift()
                let fullTitle = ""
                for (let j = 0; j < courseTitle.length; j++){
                    fullTitle += " " + courseTitle[j]
                }
                fullTitle = fullTitle.trim()
                courseInfo.splice(1, 0, fullTitle)
            }

            let course = courseInfo[0]
            if (course.trim() === currentCourseName.trim()){
                let prereq = courseInfo[4]
                let coreq = courseInfo[5]

                if (prereq === "\"\"" || prereq == null || prereq.length == 0){
                    prereq = null
                }

                if (coreq === "\"\"" || coreq == null || coreq.length == 0){
                    coreq = null
                }

                let reqBundle = [prereq, coreq]
                return reqBundle

            }

        }
    }

    /**
     * Course Name & ID
     * */
    function preReqCheck(course, target){
        let reqBundle = getReqInfo(course)
        if (reqBundle == null){
            return true
        }
        if (reqBundle[0] == null){
            return true
        }

        let preReq = reqBundle[0]
        preReq = preReq.split(";")
        for (let i = 0; i < preReq.length; i++){
            let currReq = preReq[i]
            if (currReq.includes(",")){
                let reqArr = currReq.split(",")
                for (let j = 0; j < reqArr.length; j++){
                    if (!isBefore(reqArr[j], target)){
                        return false
                    }
                }
            }
            else {
                if (!isBefore(currReq, target)){
                    return false
                }
            }
        }
        return true


    }

    function coReqCheck(course, target){
        let reqBundle = getReqInfo(course)
        if (reqBundle == null){
            return true
        }
        if (reqBundle[1] == null){
            return true
        }

        let coReq = reqBundle[1]
        coReq = coReq.split(";")
        for (let i = 0; i < coReq.length; i++){
            let currReq = coReq[i]
            if (currReq.includes(",")){
                let reqArr = currReq.split(",")
                for (let j = 0; j < reqArr.length; j++){
                    if (!isWithin(reqArr[j], target)){
                        return false
                    }
                }
            }
            else {
                if (!isWithin(currReq, target)){
                    return false
                }
            }
        }
        return true

    }

    /**
     * Takes in preReq course name
     * Target ID
     * */
    function isBefore(preReq, targetID){
        let activeCourses = document.getElementsByClassName("planner-table")
        activeCourses = Array.from(activeCourses)
        for (let i = 0; i < activeCourses.length; i++){
            let activeCourse = activeCourses[i]
            let courseName = activeCourse.innerText
            if (courseName.trim() == preReq.trim()){
                let courseID = activeCourse.id
                let idNum = parseInt(courseID.substring(courseID.length - 2))
                targetID = parseInt(targetID.substring(targetID.length - 2))
                if (targetID > idNum){
                    return true
                }
                else {
                    return false
                }
            }
        }
        return false
    }


    function isWithin(coReq, targetID){
        let activeCourses = document.getElementsByClassName("planner-table")
        activeCourses = Array.from(activeCourses)
        for (let i = 0; i < activeCourses.length; i++){
            let activeCourse = activeCourses[i]
            let courseName = activeCourse.innerText
            if (courseName.trim() == coReq.trim()){
                let courseID = activeCourse.id
                let idNum = parseInt(courseID[courseID.length - 2])
                targetID = parseInt(targetID[targetID.length - 2])
                if (targetID == idNum){
                    return true
                }
                else {
                    return false
                }
            }
        }
        return false
    }


    loadAllCourses()

    function getMajor(){
        var student_major
        if (localStorage.getItem("major") != null){
            student_major = localStorage.getItem("major")
        }
        else {
            console.log("YERRR")
            let email
            if (localStorage.getItem("student-email") == null){
                email = localStorage.getItem("email")
            }
            else {
                email = localStorage.getItem("student-email")
            }
            console.log(email)
            console.log(localStorage.getItem("planName"))

            $.ajax({
                type: "POST",
                url: "planServlet",
                async: false,
                data: {
                    action: "Get Major",
                    email: email,
                    planName: localStorage.getItem("planName")
                },
                success: function (data) {
                    student_major = data.trim()
                }
            });
        }
        return student_major
    }

    getMajor()


    updateDropDown(getMajor())  // Pull Major from its own servlet

    fillRequirements()

    function fillRequirements(){
        if (localStorage.getItem("planName") !== "Create New Plan"){
            $.ajax({
                type: "POST",
                url: "TableLoader",
                async: false,
                data: {
                    email: localStorage.getItem("email"),
                    planName: localStorage.getItem("planName")
                },
                success: function (data) {
                    data = data.trim()
                    let requirementData = pullMajorReq(data)
                    electives = requirementData[0]
                    proElectives = requirementData[1]
                    loadedClasses = dataLoader(data)
                },
                error: function (textStatus, errorThrown) {
                }

            });
        }
        else {
            let data = localStorage.getItem("data")
            let requirementData = pullMajorReq(data)
            electives = requirementData[0]
            proElectives = requirementData[1]
            loadedClasses = dataLoader(data)
        }
    }



    function loadFeedBack(){
        let requirements = electives
        requirements = parseRequirements(requirements)
        let electiveNum = proElectives[0]
        for (let i = 0; i < electiveNum; i++){
            requirements.push("ELECTIVE " + (i+1).toString())
        }
        let lengthCnt = 1
        for (let i = 0; i < requirements.length; i++){
            if (requirements[i].length > 10){
                guide["See " + (lengthCnt).toString()] = requirements[i].bold()
                requirements[i] = "See " + (lengthCnt).toString()
                lengthCnt++
            }
        }
        let tableDiv = document.getElementById("feedback-table")
        let lastVal = requirements.length - 1
        let cnt = 0
        let rowCnt = 0
        let subArray  = []
        for (let i = 0; i < requirements.length; i++){
            let req = requirements[i]
            if (cnt < 6){
                subArray.push(req)
            }
            cnt++
            if (cnt == 6 || i == lastVal){
                let buildTr = document.createElement("tr")
                buildTr.setAttribute("id", "dynamic-row" + rowCnt.toString())
                tableDiv.appendChild(buildTr)
                let row = document.getElementById("dynamic-row"+rowCnt.toString())
                row.style.border = "none"
                for (let j = 0; j < subArray.length; j++){
                    let buildTd = document.createElement("td")
                    buildTd.setAttribute("id", subArray[j]+"-row")
                    buildTd.setAttribute("class", "unique-requirement")
                    row.appendChild(buildTd)
                    let tdStyle = document.getElementById(subArray[j]+"-row")
                    tdStyle.innerHTML=subArray[j]
                    tdStyle.style.border = "none"
                    tdStyle.style.fontSize = "10px"
                    let buildCB = document.createElement("input")
                    buildCB.setAttribute("id", subArray[j])
                    buildCB.setAttribute("type", "checkbox")
                    buildCB.setAttribute("value", subArray[j])
                    buildCB.setAttribute("readonly", "readonly")
                    buildCB.onclick = function () {return false;}
                    buildTd.appendChild(buildCB)
                }
                rowCnt++
                cnt=0
                subArray = []
            }

        }
    }
    loadFeedBack()

    function createGuide(){
        let tooltip = document.getElementById("guide-ref")
        let guideStr = ""
        for (const [key, value] of Object.entries(guide)) {
            let guideP = document.createElement("p")
            guideP.innerHTML = (key.split(" ")[1]).bold() + ": " + value
            tooltip.appendChild(guideP)
        }
    }

    createGuide()

    function getFeedBack(){
        let requirements = document.getElementsByClassName("unique-requirement")
        let activeCourses = document.getElementsByClassName("planner-table")
        activeCourses = Array.from(activeCourses)

        for (let i = 0; i < requirements.length; i++){
            requirements[i].childNodes[1].checked = false
        }

        let coreReq = document.getElementsByClassName("core-curr")
        for (let i = 0; i < coreReq.length; i++){
            coreReq[i].childNodes[0].checked = false
        }

        let currCourses = []
        for (let i = 0; i < activeCourses.length; i++){
            let course = activeCourses[i].innerHTML
            course = course.split(" ")[0].split("<")[0]
            currCourses.push(course)
        }

        for (let i = 0; i < requirements.length; i++){
            let course = requirements[i].innerText
            if (course.includes("See")){
                course = guide[course]
            }

            if (course.includes("ELECTIVE")){
                if (requirements[i].childNodes[1].checked == "true"){
                    continue
                }
                else {
                    let options = proElectives
                    if (options.length == 2){
                        let locateNumber = course.split(" ")[1]
                        locateNumber = parseInt(locateNumber)
                        let locateCnt = 0
                        for (let j = 0; j < options[1].length; j++){
                            let electOpt = options[1][j]
                            for (let k = 0; k < currCourses.length; k++){
                                let currentCourseOption = currCourses[k]
                                if (electOpt === currentCourseOption){
                                    locateCnt++
                                    if (locateCnt === locateNumber){
                                        requirements[i].childNodes[1].checked = "true"
                                    }
                                    else{
                                        continue
                                    }
                                }
                            }
                        }
                    }
                    else {
                        let totalReq = options[0]
                        let locateNumber = course.split(" ")[1]
                        locateNumber = parseInt(locateNumber)
                        let locateCnt = 0
                        options.shift()
                        for (let j = 0; j < options.length; j++){
                            let subOption = options[j]
                            let numReq = subOption[0]
                            let arrReq = subOption[1]
                            for (let k = 0; k < currCourses.length; k++){
                                let currentCourse = currCourses[k]
                                if (arrReq.includes(currentCourse)){
                                    locateCnt++
                                    if (locateCnt === locateNumber || locateCnt == totalReq){
                                        requirements[i].childNodes[1].checked = "true"
                                    }
                                    else{
                                        continue;
                                    }
                                }
                            }
                        }
                    }

                }
            }

            if (course.includes("/")){
                course = course.split("/")
                for (let j = 0; j < course.length; j++){
                    let subCourse = course[j]
                    if (currCourses.includes(subCourse)){
                        requirements[i].childNodes[1].checked = "true"
                    }
                }
                continue;
            }

            if (currCourses.includes(course)){
                requirements[i].childNodes[1].checked = "true"
            }

        }

        let addScienceChecked = false
        for (let i = 0; i < coreReq.length; i++){
            let coreVal = coreReq[i].innerText
            let checkPresent = hasMet(coreVal)
            if (coreVal === "AINW"){
                if (checkPresent){
                    let metADD = metAdditionalScienceReq("AINW")    // check for additional requirment
                    if (metADD){
                        addScienceChecked = true
                    }
                    else {
                        addScienceChecked = false
                    }
                }
            }
            if (coreVal === "ADDSCI"){
                coreReq[i].childNodes[0].checked = addScienceChecked
                continue
            }
            if (checkPresent){
                coreReq[i].childNodes[0].checked = "true"
            }

        }


    }

    function metAdditionalScienceReq(category) {
        let activeCourses = document.getElementsByClassName("planner-table")
        activeCourses = Array.from(activeCourses)

        let indexHolder = []
        let requirements = matchRequirements(category)
        let creditsNeeded = requirements[0]
        let creditCnt = 0
        requirements = requirements[1]
        for (let i = 0; i < requirements.length; i++) {
            let req = requirements[i]
            let course = req[0]
            let credits = parseInt(req[2])

            for (let j = 0; j < activeCourses.length; j++) {
                let activeCourse = activeCourses[j].innerText
                if (course.replace("*", "") === activeCourse.replace("*", "")) {
                    if (creditCnt >= creditsNeeded){
                        break
                    }
                    creditCnt += credits
                    indexHolder.push(j)
                }
            }
        }
        for (let i = 0; i < indexHolder.length; i++){
            let deleteIndex = indexHolder[i]
            activeCourses.splice(deleteIndex, 1)
        }
        console.log(activeCourses)

        let actuallyMet = hasMetPreSet(activeCourses)
        return actuallyMet
    }

    getFeedBack()

    function hasMet(category){
        let activeCourses = document.getElementsByClassName("planner-table")
        let courseNames = []
        activeCourses = Array.from(activeCourses)
        for (let i = 0; i < activeCourses.length; i++){
            let course = activeCourses[i].innerHTML.trim()
            course = course.split(" ")[0].split("<")[0]
            if (course.length == 0){
                continue;
            }
            courseNames.push(course)
        }

        if (category === "electives"){
            let requirements = matchRequirements(category)
            requirements = parseRequirements(requirements)
            let met = electiveIncludes(requirements, courseNames)
            return met
        }
        else {
            let requirements = matchRequirements(category)
            let creditsNeeded = requirements[0]
            requirements = requirements[1]
            let metCnt = 0;
            for (let i = 0; i < requirements.length; i++){
                let req = requirements[i]
                let course = req[0]
                let credits = parseInt(req[2])
                for (let j = 0; j < courseNames.length; j++){
                    let activeCourse = courseNames[j]
                    if (course.replace("*","") === activeCourse.replace("*","")){
                        metCnt += credits
                    }
                }

            }
            if (metCnt >= creditsNeeded){
                return true
            }
            else{
                return false
            }
        }

    }

    function hasMetPreSet(activeCourses){
        let courseNames = []
        activeCourses = Array.from(activeCourses)
        for (let i = 0; i < activeCourses.length; i++){
            let course = activeCourses[i].innerHTML.trim()
            course = course.split(" ")[0].split("<")[0]
            if (course.length == 0){
                continue;
            }
            courseNames.push(course)
        }

        let requirements = matchRequirements("AINW")
        let creditsNeeded = requirements[0]
        requirements = requirements[1]
        let metCnt = 0;
        for (let i = 0; i < requirements.length; i++){
            let req = requirements[i]
            let course = req[0]
            let credits = parseInt(req[2])
            for (let j = 0; j < courseNames.length; j++){
                let activeCourse = courseNames[j]
                if (course.replace("*","") === activeCourse.replace("*","")){
                    metCnt += credits
                }
            }

        }
        if (metCnt >= creditsNeeded){
            return true
        }
        else{
            return false
        }
    }


    function electiveIncludes(requirements, courses){
        for (let i = 0; i < requirements.length; i++){
            let req = requirements[i]
            let metCnt = 0
            for (let j = 0; j < courses.length; j++){
                let course = courses[j]
                if (req.includes("/")){
                    if (req.includes(course)){
                        metCnt++
                    }
                }
                else{
                    if (req === course){
                        metCnt++;
                    }
                }
            }
            if (metCnt == 0){
                return false
            }
        }
        return true
    }

    function parseRequirements(requirements){
        for (let i = 0; i < requirements.length; i++){
            let requirement = requirements[i]
            if (requirement.includes("/")){
                let slashIndex = requirement.indexOf("/")
                let indexAfterSlash = slashIndex+1
                if (is_numeric(requirement[indexAfterSlash])){
                    let divReq = requirement.split("/")
                    let stopCharIndex
                    for (let j = 0; j < divReq[0].length; j++){
                        let char = divReq[0][j]
                        if (is_numeric(char)){
                            stopCharIndex = j
                            break;
                        }
                    }
                    let prevCourse = divReq[0].slice(0, stopCharIndex)
                    prevCourse += divReq[1]
                    requirements.push(prevCourse)
                    requirements[i] = divReq[0]
                }
            }
        }
        return requirements
    }

    function is_numeric(str){
        return /^\d+$/.test(str);
    }


    /**
     * Returns [electives, proelectives]
     * proelectives = [number required, course options] OR
     * [totalNumberRequired, [number required, course options], [number required, course options]]
     * @param data
     */
    function pullMajorReq(data){
        let elective
        let proElective
        let parseIndex = 0
        data = data.split("\n")
        for (let i = 0; i < data.length; i++){
            data[i] = data[i].trim()
        }

        parseIndex = data.indexOf("")
        data = data.splice(parseIndex)
        elective = data
        elective.splice(parseIndex)
        elective.shift()
        elective.pop()
        elective = elective[0]
        elective = elective.split(",")

        proElective = data
        proElective.shift()
        proElective = proElective[0]

        if (proElective.includes(",")){
            let fullReq = []
            let totalReq = proElective[0]
            let totalNumReq = totalReq
            totalReq = proElective
            totalReq = totalReq.substring(2, totalReq.length - 2)
            totalReq = totalReq.split(",")
            for (let i = 0; i < totalReq.length; i++){
                let reqLine = totalReq[i]
                reqLine = reqLine.replace("(", "").replace(")", "").replace("(", "").replace(")", "")
                reqLine = reqLine.split(":")
                let numReq = reqLine[0]
                if (i === totalReq.length - 1){
                    let origReq = totalNumReq
                    let options = numReq.split("/")
                    let req = [origReq, options]
                    fullReq.push(req)
                    continue
                }
                let options = reqLine[1].split(";")
                let req = [numReq, options]
                fullReq.push(req)
            }

            return [elective, fullReq]
        }
        else {
            proElective = proElective.replace("(", "").replace(")", "")
            proElective = proElective.split(":")
            let numReq = proElective[0]
            let options = proElective[1].split(";")
            let req = [numReq, options]
            return [elective, req]

        }

    }

    function pullLiberalLearning(LLC){
        let filepath = "PCSE/" + "LLC/" + LLC + ".txt";
        var courses = []
        let fullCourses = []
        $.ajax({
            type: "GET",
            url: filepath,
            dataType: "text",
            async: false,
            success: function (data) {
                courses = data
                courses = courses.split("\n")
            }
        });

        for (let i = 0; i < courses.length; i++){
            let currentCourse = courses[i].split("\t");
            let courseName = currentCourse[0];
            let courseDescription = currentCourse[1]
            let courseCredits = currentCourse[2]
            let courseBundle = [courseName, courseDescription, courseCredits]
            fullCourses.push(courseBundle)
        }
        return fullCourses
    }

    function dataLoader(data){
        let pulledCourses = []
        data = data.split("\n")
        let blankLineIndex = getBlankLineIndex(data)

        for (let i = 0; i < blankLineIndex; i++){
            let line = data[i].trim().split(",")
            line = fillArray(line)
            for (let j = 0; j < line.length; j++){
                let course = line[j];
                let credits = getNumCredits(course)

                if (localStorage.getItem("chosen") === "blank" && localStorage.getItem("planName") === "Create New Plan"){
                    course = ""
                    credits = ""
                }

                pulledCourses.push(course)


                document.getElementById("plan" + i.toString() + j.toString()).innerHTML = course;
                document.getElementById("credit" + i.toString() + j.toString()).innerHTML = credits
                document.getElementById("plan" + i.toString() + j.toString()).setAttribute("class", "planner-table")
                document.getElementById("plan" + i.toString() + j.toString()).addEventListener("onmouseover", function(){
                    showCloseButton(this);
                }, false)

                let closeButton = document.createElement("button")
                closeButton.setAttribute("class", "clear-course")
                closeButton.setAttribute("id", "clear-button" + i.toString() + j.toString())
                closeButton.innerHTML= "X"
                closeButton.style.visibility = "hidden"
                document.getElementById("plan" + i.toString() + j.toString()).appendChild(closeButton)
                document.getElementById("clear-button" + i.toString() + j.toString()).addEventListener("click", function(){
                    clearCourseInfo(this);
                }, false)
            }
        }
        return pulledCourses
    }

    function showCloseButton(location){
        if (CURRENT_ELEMENT != null && location.innerText.length != 0){
            location.firstElementChild.style.visibility = "hidden"

        }
        else {
            if (location.innerText.length == 0){
                location.firstElementChild.style.visibility = "hide"
            }
            else{
                location.firstElementChild.style.visibility = "visible"
            }
        }

        let targetCourseID = location.id

        let curr_elm = CURRENT_ELEMENT.innerHTML

        let pRCheck = preReqCheck(curr_elm, targetCourseID)
        let cRCheck = coReqCheck(curr_elm, targetCourseID)

        let targetCourseElm = document.getElementById(targetCourseID)
        if (pRCheck && cRCheck){
            targetCourseElm.style.border = "2px solid green"
            location.firstElementChild.style.visibility = "hide"
        }
        else {
            targetCourseElm.style.border = "2px solid red"
            location.firstElementChild.style.visibility = "hide"
        }


    }

    function hideCloseButton(location){
        let targetCourseElm = document.getElementById(location.id)
        location.firstElementChild.style.visibility = "hidden"
        targetCourseElm.style.border = "1px solid black"
    }

    function clearCourseInfo(course){
        let parent_id = course.parentElement.id
        let hold_course_info = course.parentElement.innerText.substring(0, course.parentElement.innerText.length - 1)
        course.parentElement.innerHTML = ""

        let buildButton = document.createElement("button")
        buildButton.setAttribute("class", "clear-course")
        buildButton.setAttribute("id", "clear-button" + course.id.slice(-2))
        buildButton.style.visibility = "hidden"
        buildButton.innerHTML = "X"
        document.getElementById(parent_id).appendChild(buildButton)

        let credit_id = "credit" + course.id.slice(-2)
        document.getElementById(credit_id).innerHTML = ""

        //__________________________________________
        // DELETING COURSES THAT COUNT AS THAT
        let cutIndex
        let activeCourses = document.getElementsByClassName("planner-table")
        for (let i = 0; i < activeCourses.length; i++){
            let activeCourse = activeCourses[i].id
            if (activeCourse === parent_id){
                cutIndex = i
            }
        }
        activeCourses = Array.from(activeCourses).splice(cutIndex)

        let firstWarning = false
        for (let i = 0; i < activeCourses.length; i++){
            let child = activeCourses[i].children[0]
            let parent_id = child.parentElement.id
            let activeCourse = activeCourses[i].innerText
            let activeCourseID = activeCourses[i].id
            let checkPQ = preReqCheck(activeCourse, activeCourseID)
            if (!checkPQ){
                let message = "Delete all additional courses that require " + hold_course_info + " as a prerequisite?"
                message += "\nSelect Ok to Remove Them & Cancel to Delete Only the Selected Course"
                if (!firstWarning){
                    let recursiveRemoval = confirm(message)
                    firstWarning = true
                    if (!recursiveRemoval){
                        break
                    }
                }

                child.parentElement.innerHTML = ""

                let buildButton = document.createElement("button")
                buildButton.setAttribute("class", "clear-course")
                buildButton.setAttribute("id", "clear-button" + child.id.slice(-2))
                buildButton.style.visibility = "hidden"
                buildButton.innerHTML = "X"
                document.getElementById(parent_id).appendChild(buildButton)

                let credit_id = "credit" + child.id.slice(-2)
                document.getElementById(credit_id).innerHTML = ""

                i = 0
            }
        }
        form_changed = true

        //__________________________________________

        getFeedBack()
        changeOptions()

    }


    function getNumCredits(course){
        let classType = course.substring(0,4)

        if (course.trim().length == 0){
            return ""
        }

        switch (classType){
            case ("CPEN"):
                for (let i = 0; i < CPEN.length; i++){
                    let courseInfo = CPEN[i].split("\t");
                    let courseTitle = courseInfo[0];
                    if (course === courseTitle){
                        let credits = courseInfo[2];
                        return credits
                    }
                }

            case ("CPSC"):
                for (let i = 0; i < CPSC.length; i++){
                    let courseInfo = CPSC[i].split("\t");
                    let courseTitle = courseInfo[0];
                    if (course === courseTitle){
                        let credits = courseInfo[2];
                        return credits
                    }
                }

            case ("CYBR"):
                for (let i = 0; i < CYBR.length; i++){
                    let courseInfo = CYBR[i].split("\t");
                    let courseTitle = courseInfo[0];
                    if (course === courseTitle){
                        let credits = courseInfo[2];
                        return credits
                    }
                }

            case ("EENG"):
                for (let i = 0; i < EENG.length; i++){
                    let courseInfo = EENG[i].split("\t");
                    let courseTitle = courseInfo[0];
                    if (course === courseTitle){
                        let credits = courseInfo[2];
                        return credits
                    }
                }

            case ("ENGR"):
                for (let i = 0; i < ENGR.length; i++){
                    let courseInfo = ENGR[i].split("\t");
                    let courseTitle = courseInfo[0];
                    if (course === courseTitle){
                        let credits = courseInfo[2];
                        return credits
                    }
                }

            case ("PHYS"):
                for (let i = 0; i < PHYS.length; i++){
                    let courseInfo = PHYS[i].split("\t");
                    let courseTitle = courseInfo[0];
                    if (course === courseTitle){
                        let credits = courseInfo[2];
                        return credits
                    }
                }


        }
        return "3";
    }

    function fillArray(array){
        if (array.length == 6){
            return array
        }
        else {
            let addition = 6 - array.length
            for (let i = 0; i < addition; i++){
                array.push(" ")
            }
            return array;
        }
    }

    function getBlankLineIndex(data){
        for (let i = 0; i < data.length; i++){
            let line = data[i].trim();
            if (line.length == 0){
                return i;
            }
        }
    }

    function getFilePath(major){
        major = major.toUpperCase()
        let filePath = "PCSE/" + major + ".txt"
        return filePath
    }

    function loadCourse(filepath){
        var course = []
        $.ajax({
            type: "GET",
            url: filepath,
            dataType: "text",
            async: false,
            success: function (data) {
                course = data
                course = course.split("\n")
            }
        });
        return course;
    }

    function loadAllCourses(){
        CPEN = loadCourse(getFilePath("CPEN"))
        CPSC = loadCourse(getFilePath("CPSC"))
        CYBR = loadCourse(getFilePath("CYBR"))
        EENG = loadCourse(getFilePath("EENG"))
        ENGR = loadCourse(getFilePath("ENGR"))
        PHYS = loadCourse(getFilePath("PHYS"))
        BSIS = loadCourse(getFilePath("BSIS"))
    }

    function updateDropDown(data){
        switch (data.trim()){
            case ("Computer Science"):
                document.getElementById("majorSelect").innerHTML = "CPSC"
                document.getElementById("majorSelect").value = "CPSC"
                hideDropdowns(data)
                loadOptions()
                return

            case ("Computer Engineering"):
                document.getElementById("majorSelect").innerHTML = "CPEN"
                document.getElementById("majorSelect").value = "CPEN"
                hideDropdowns(data)
                loadOptions()
                return

            case ("Cyber Security"):
                document.getElementById("majorSelect").innerHTML = "CYBR"
                document.getElementById("majorSelect").value = "CYBR"
                hideDropdowns(data)
                loadOptions()
                return

            case ("Electrical Engineering"):
                document.getElementById("majorSelect").innerHTML = "EENG"
                document.getElementById("majorSelect").value = "EENG"
                hideDropdowns(data)
                loadOptions()
                return

            case ("Information Science"):
                document.getElementById("majorSelect").innerHTML = "BSIS"
                document.getElementById("majorSelect").value = "BSIS"
                hideDropdowns(data)
                loadOptions()
                return
        }
    }

    function hideDropdowns(type){
        let cpsc = document.getElementById("CPSC-Select")
        let cpen = document.getElementById("CPEN-Select")
        let cybr = document.getElementById("CYBR-Select")
        let eeng = document.getElementById("EENG-Select")
        let engr = document.getElementById("ENGR-Select")
        let bsis = document.getElementById("BSIS-Select")

        cpsc.hidden = true
        cpen.hidden = true
        cybr.hidden = true
        eeng.hidden = true
        engr.hidden = true
        bsis.hidden = true

        switch (type){
            case ("Computer Science"):
                cpen.hidden = false
                engr.hidden = false
                return

            case ("Computer Engineering"):
                cpen.hidden = true
                engr.hidden = false
                return

            case ("Cyber Security"):
                cpsc.hidden = false
                engr.hidden = false
                cpen.hidden = false
                return

            case ("Electrical Engineering"):
                cpsc.hidden = false
                engr.hidden = false
                cpen.hidden = false
                return

            case ("Information Science"):
                cpsc.hidden = false
                cpen.hidden = false
                return
        }
    }

    function loadOptions(){
        let major = document.getElementById("currentOption").value;
        let courseOptions = []
        if (major === "CPEN") { courseOptions = CPEN }
        else if (major === "CPSC") { courseOptions = CPSC } else if (major === "CYBR") { courseOptions = CYBR }
        else if (major === "EENG") { courseOptions = EENG } else if (major === "ENGR") { courseOptions = ENGR }
        else if (major === "PHYS") { courseOptions = PHYS } else if (major === "BSIS") { courseOptions = BSIS }
        else {
            courseOptions = pullLiberalLearning(major)
        }
        courseOptions = getCourseNames(courseOptions)
        courseOptions = removeActiveCourses(courseOptions)
        optionLoader(courseOptions, major)
    }

    function changeOptions(){
        let major = document.getElementById("currentOption").value;
        let courseOptions = []
        if (major === "CPEN") { courseOptions = CPEN }
        else if (major === "CPSC") { courseOptions = CPSC } else if (major === "CYBR") { courseOptions = CYBR }
        else if (major === "EENG") { courseOptions = EENG } else if (major === "ENGR") { courseOptions = ENGR }
        else if (major === "PHYS") { courseOptions = PHYS } else if (major === "BSIS") { courseOptions = BSIS }
        else {
            courseOptions = pullLiberalLearning(major)
        }
        courseOptions = getCourseNames(courseOptions)
        courseOptions = removeActiveOptions(courseOptions)
        optionLoader(courseOptions, major)
    }

    function removeActiveCourses(courseOptions){
        let pulledCourses = []
        if (localStorage.getItem("planName") !== "Create New Plan"){
            $.ajax({
                type: "POST",
                url: "TableLoader",
                async: false,
                data: {
                    email: localStorage.getItem("email"),
                    planName: localStorage.getItem("planName")
                },
                success: function (data) {
                    let requirementData = pullMajorReq(data)
                    electives = requirementData[0]
                    proElectives = requirementData[1]
                    loadedClasses = dataLoader(data)
                    pulledCourses = loadedClasses
                },
                error: function (textStatus, errorThrown) {
                }

            });
        }
        else {
            let data = localStorage.getItem("data")
            let requirementData = pullMajorReq(data)
            electives = requirementData[0]
            proElectives = requirementData[1]
            loadedClasses = dataLoader(data)
            pulledCourses = loadedClasses
        }

        let dupCourses = []

        for (let i = 0; i < courseOptions.length; i++){
            let course = courseOptions[i]
            for (let j = 0; j < pulledCourses.length; j++){
                let pulledCourse = pulledCourses[j]
                if (pulledCourse.includes(course)){
                    dupCourses.push(course)
                }
            }
        }
        dupCourses = [...new Set(dupCourses)]

        let origCourses = []
        for (let i = 0; i < courseOptions.length; i++){
            let course = courseOptions[i]
            if (!dupCourses.includes(course)){
                origCourses.push(course)
            }
        }
        return origCourses
    }

    function removeActiveOptions(courseOptions){
        let activeElections = document.getElementsByClassName("planner-table")
        activeElections = Array.from(activeElections)

        let dupCourses = []

        for (let i = 0; i < courseOptions.length; i++){
            let course = courseOptions[i]   // get course option
            for (let j = 0; j < activeElections.length; j++){
                let pulledCourse = activeElections[j].innerText
                if (pulledCourse.trim() === course.replace("*", "")){
                    dupCourses.push(course)
                }


            }
        }
        dupCourses = [...new Set(dupCourses)]

        let origCourses = []
        for (let i = 0; i < courseOptions.length; i++){
            let course = courseOptions[i]
            if (!dupCourses.includes(course)){
                origCourses.push(course)
            }
        }

        return origCourses

    }

    function optionLoader(courseOptions, major){
        document.getElementById("holdOptions").innerHTML = ''
        let mainDiv = document.getElementById("course-loader")
        let optionDiv = document.getElementById("holdOptions")

        let initialIndex = 0
        let cnt = 0
        for (let i = 0; i < courseOptions.length; i++){
            if (cnt == 7){
                initialIndex += 1
                cnt = 0;
            }
            let courseName = courseOptions[i]
            let courseBody = document.createElement("p")
            courseBody.setAttribute("id", major + ":" + courseName)
            courseBody.setAttribute("class", "courseOptions")
            courseBody.innerHTML = courseName.replace("*","")
            courseBody.addEventListener("click", function(){
                showCourseInformation(this)
            }, false)

            optionDiv.appendChild(courseBody)

            let courseStyling = document.getElementById(major + ":" + courseName)
            courseStyling.style.zIndex = "10"
            courseStyling.style.fontSize = "13px"
            courseStyling.style.position = "absolute"
            courseStyling.style.border = "1px solid black"
            courseStyling.style.width = "12%"
            courseStyling.style.height = "17px"
            courseStyling.style.textAlign = "center"
            courseStyling.style.left = getLeft(i)
            if (i < 7){
                courseStyling.style.top = "9%"
            }
            else {
                courseStyling.style.top = initialIndex.toString() + "9%"
            }
            dragElement(document.getElementById(major + ":" + courseName))
            cnt += 1
        }
        mainDiv.appendChild(optionDiv)
    }

    function getCourseNames(courses){
        let courseNames = []
        for (let i = 0; i < courses.length; i++){
            let currentCourse = courses[i]
            if (currentCourse.length == 0){
                continue;
            }
            if (typeof currentCourse === "object"){
                let courseName = currentCourse[0]
                if (courseName.includes(" ")){
                    courseName = courseName.split(" ")[0]
                }
                courseNames.push(courseName)
            }
            else {
                let courseName = currentCourse.split("\t")[0]
                if (courseName.includes(" ")){
                    courseName = courseName.split(" ")[0]
                }
                courseNames.push(courseName)
            }

        }
        return courseNames
    }

    function matchRequirements(category) {
        switch (category) {
            case ("pro electives"):
                return proElectives

            case ("electives"):
                return electives

            case ("AIDE"):
                return aideReq

            case ("AICE"):
                return aiceReq

            case ("ADDSCI"):
                return addsciReq

            case ("AIGM"):
                return aigmReq

            case ("AINW"):
                return ainwReq

            case ("AIWT"):
                return aiwtReq

            case ("WI"):
                return WIreq

            case ("ECON"):
                return econReq

            case ("LR"):
                return lrReq

            case ("MATH"):
                return mathReq

            case ("SLL"):
                return sllReq

            case ("WCL"):
                return wclReq
        }
    }

    function chooseMajorOptions(major){
        let courseOptions = []
        if (major === "CPEN") { courseOptions = CPEN }
        else if (major === "CPSC") { courseOptions = CPSC } else if (major === "CYBR") { courseOptions = CYBR }
        else if (major === "EENG") { courseOptions = EENG } else if (major === "ENGR") { courseOptions = ENGR }
        else if (major === "PHYS") { courseOptions = PHYS } else if (major === "BSIS") { courseOptions = BSIS }
        else {
            courseOptions = pullLiberalLearning(major)
        }
        return courseOptions
    }

    /**
     * If Liberal Learning: Only Options are "name" and "credits"
     * If Major: All options are "name", "credits", "description"
     * @param major
     * @param detail
     * @param course
     * @returns {*|string}
     */
    function getCourseDetails(major, detail, course){
        let lastChar = course.substr(-1)
        if (lastChar === "L"){
            return 1
        }
        let course_options = chooseMajorOptions(major)
        for (let i = 0; i < course_options.length; i++){
            let courseRow = course_options[i]
            if (typeof courseRow === "object"){
                if (detail === "credits"){
                    return courseRow[2]
                }
                else {
                    return courseRow[1]
                }
            }
            else {
                let spec_course = courseRow.split("\t")[0].trim()
                if (spec_course.split(" ").length > 1){
                    if (detail === "name"){
                        let fullname = spec_course.split(" ")[1]
                        for (let j = 1; j < spec_course.length; j++){
                            fullname += " " + spec_course.split(" ")[i]
                        }
                        return fullname
                    }
                    else if (detail=== "credits"){
                        return courseRow.split("\t")[1]
                    }
                    else {
                        return courseRow.split("\t")[2]
                    }
                }

                if (course.trim() === spec_course){
                    if (detail === "credits"){
                        return courseRow.split("\t")[2]
                    }
                    else if (detail === "name"){
                        return courseRow.split("\t")[1]
                    }
                    else {
                        return courseRow.split("\t")[3]
                    }
                }
            }
        }
    }

    function getLeft(i){
        i += 1
        let val
        if (i < 7){
            val = i
        }
        else {
            val = i%7
        }

        switch (val){

            case (0):
                return "605px"

            case (1):
                return "5px"

            case (2):
                return "105px"

            case (3):
                return "205px"

            case (4):
                return "305px"

            case (5):
                return "405px"

            case (6):
                return "505px"

        }
    }

    function navMain(){
        let location
        if (localStorage.getItem("student-email") == null){
            location = "welcome.html"
        }
        else {
            location = "student_plans.html"
        }

        if (!form_changed){
            window.location.href = location
            return
        }
        if (!SAVED){
            let saveBeforeExit = confirm("Would you like to save your plan before you exit?")
            if (!saveBeforeExit){
                window.location.href = location
            }
            else {
                savePlan()
                setTimeout(function(){ window.location.href = location }, 1000)
            }
        }
        else {
            window.location.href = location
        }
    }

    /**
     * [left, top]
     * @param course
     */
    function getOriginalDimensions(){
        let options = Array.from(document.getElementsByClassName("courseOptions"))
        let option_packs = []
        for (let i = 0; i < options.length; i++){
            let course_name = options[i].innerHTML
            let course_left = options[i].style.left
            let course_top = options[i].style.top
            let option_package = [course_name, course_left, course_top]
            option_packs.push(option_package)
        }
        return option_packs
    }

    function savePlan(){
        if (!form_changed){
            alert("Please Make a Change Before Saving")
            return false;
        }
        let saveString = ""
        let active = document.getElementsByClassName("planner-table")
        active = Array.from(active)

        let subArr = []
        let tempArr = []
        for (let i = 0; i < active.length; i++){
            let activeCourse = active[i].innerText
            tempArr.push(activeCourse)

            let iteration = i+1
            if (iteration % 12 == 0){
                let sortA = []
                let sortB = []
                for (let j = 0; j < tempArr.length; j++){
                    if (j % 2 == 0){
                        sortA.push(tempArr[j])
                    }
                    else {
                        sortB.push(tempArr[j])
                    }
                }
                let combinedArr = sortA.concat(sortB)
                subArr.push(combinedArr)
                tempArr = []
            }
        }

        let fullArr = subArr[0].concat(subArr[1]).concat(subArr[2]).concat(subArr[3])

        let cnt = 0
        for (let i = 0; i < fullArr.length; i++){
            let activeCourse = fullArr[i]
            saveString += activeCourse + ","
            cnt++
            if (cnt == 6){
                saveString = saveString.substring(0, saveString.length - 1)
                saveString += "\n"
                cnt = 0
            }
        }

        if (localStorage.getItem("planName") == "Create New Plan" && !SAVED){ // If new plan
            let origNumPlans = "1"
            if (localStorage.getItem("numPlans") != null){  // If there are multiple plans, make the default "Plan" + current number
                origNumPlans = localStorage.getItem("numPlans")
            }
            let newPlanName = prompt("Please Enter a Plan Name.", "Plan " + origNumPlans)
            if (!newPlanName){
                return false
            }

            let specialCharacters = "/<>;:{}[]*&^%$#@!"
            specialCharacters = specialCharacters.split("")
            for (let i = 0; i < specialCharacters.length; i++){
                let specialCharacter = specialCharacters[i]
                if (newPlanName.includes(specialCharacter)){
                    alert("Plan name cannot include certain special characters. Please try again")
                    return false
                }
            }


            let email
            if (localStorage.getItem("student-email") != null){
                email = localStorage.getItem("student-email")
                newPlanName = "941X" + newPlanName
            }
            else {
                email = localStorage.getItem("email")
            }


            let major = localStorage.getItem("major")
            SAVED = true

            $.ajax({
                type: "POST",
                url: "saveServlet",
                data: {
                    planName: newPlanName,
                    email: email,
                    fullPlan: saveString,
                    newPlan: "True",
                    newMajor: major
                },
                success: function (data) {
                    if (data.trim() === "Already Exists"){
                        alert("Plan Name already exists. Please enter a New Name.")
                        SAVED = false
                    }
                    if (data.trim() === "true"){
                        alert("Plan Saved Successfully!")
                        localStorage.setItem("planName", newPlanName)
                    }
                },
                error: function (textStatus, errorThrown) {

                }

            });
        }
        else {
            let email
            if (localStorage.getItem("student-email") != null && !localStorage.getItem("planName").includes("941X")){
                alert("Cannot edit a student's plan. Please make a copy")
                return false
                email = localStorage.getItem("student-email")
            }
            else {
                email = localStorage.getItem("email")
            }
            let savedPlan = localStorage.getItem("planName")
            let major = localStorage.getItem("major")
            SAVED = true

            $.ajax({
                type: "POST",
                url: "saveServlet",
                data: {
                    planName: savedPlan,
                    email: email,
                    fullPlan: saveString,
                    newPlan: "False",
                    newMajor: major
                },
                success: function (data) {
                    if (data.trim() === "true"){
                        alert("Plan Saved Successfully!")
                    }
                },
                error: function (textStatus, errorThrown) {
                    console.log(textStatus)
                }

            });

        }

    }

    function exportPlan(){
        if (!SAVED){
            alert("Please save your plan before exporting!")
            return false
        }
        let active = document.getElementsByClassName("planner-table")
        active = Array.from(active)

        let subArr = []
        let tempArr = []
        let subArr_Cred = []
        let tempArr_Cred = []
        for (let i = 0; i < active.length; i++){
            let activeCourse = active[i].innerText
            tempArr.push(activeCourse)
            let credits = document.getElementById("credit" + active[i].id.substring(4)).innerText
            tempArr_Cred.push(credits)


            let iteration = i+1
            if (iteration % 12 == 0){
                let sortA = []
                let sortB = []
                let sortA_Cred = []
                let sortB_Cred = []
                for (let j = 0; j < tempArr.length; j++){
                    if (j % 2 == 0){
                        sortA.push(tempArr[j])
                        sortA_Cred.push(tempArr_Cred[j])
                    }
                    else {
                        sortB.push(tempArr[j])
                        sortB_Cred.push(tempArr_Cred[j])
                    }
                }
                let combinedArr = sortA.concat(sortB)
                let combinedArr_Cred = sortA_Cred.concat(sortB_Cred)
                subArr.push(combinedArr)
                subArr_Cred.push(combinedArr_Cred)
                tempArr = []
                tempArr_Cred = []
            }
        }

        let fullArr = subArr[0].concat(subArr[1]).concat(subArr[2]).concat(subArr[3])
        let fullArr_Cred = subArr_Cred[0].concat(subArr_Cred[1]).concat(subArr_Cred[2]).concat(subArr_Cred[3])

        let saveString = ""
        let cnt = 0
        for (let i = 0; i < fullArr.length; i++){
            let courseName = fullArr[i]
            let credits = fullArr_Cred[i]

            if (courseName.length == 0){
                saveString += ";"
            }
            else {
                saveString += courseName + "," + credits + ";"
            }
            cnt++
            if (cnt == 6){
                saveString = saveString.substring(0, saveString.length - 1)
                saveString += "\n"
                cnt = 0
            }
        }

        let email
        if (localStorage.getItem("student-email") != null && !localStorage.getItem("planName").includes("941X")){
            email = localStorage.getItem("student-email")
        }
        else {
            email = localStorage.getItem("email")
        }

        $.ajax({
            type: "POST",
            url: "exportServlet",
            data: {
                fullPlan: saveString,
                email: email,
                planName: localStorage.getItem("planName").replace("941X","")

            },
            success: function (data) {
                if (data.trim() === "true"){
                    alert("Plan Exported. Please check your downloads folder.")
                }
            },
            error: function (textStatus, errorThrown) {
                console.log(textStatus)
            }

        });

    }





</script>
</html>